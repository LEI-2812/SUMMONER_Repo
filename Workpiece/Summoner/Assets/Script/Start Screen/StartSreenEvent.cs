using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.SceneManagement;
using UnityEngine.UI;

public class StartSreenEvent : MonoBehaviour
{
    private GameObject optionCanvasAudio;
    public GameObject newAlert;
    public GameObject loadAlert;
    public Button settingBtn;

    public AudioSource audioSource;


    void Start()
    {
        // OptionCanvas_Audio 오브젝트를 씬에서 찾아서 참조
        optionCanvasAudio = GameObject.Find("OptionCanvas_Audio");

        // 만약 씬에 오브젝트가 없을 경우 오류 방지
        if (optionCanvasAudio == null)
        {
            Debug.LogError("OptionCanvas_Audio 오브젝트가 없음.");
        }

        // Setting 버튼 클릭 이벤트를 연결
        if (settingBtn != null)
        {
            settingBtn.onClick.AddListener(openOption); // 버튼에 openOption 이벤트 연결
        }
        else
        {
            Debug.LogError("Setting 버튼이 연결되지 않았습니다.");
        }

    }
    //스테이지 저장 (매 스테이지 클리어마다 호출하면됨.)
    public void SaveStage(int stageNumber)
    {
        // "CurrentStage"라는 키로 스테이지 번호를 저장합니다.
        PlayerPrefs.SetInt("SaveStage", stageNumber);
        PlayerPrefs.Save(); // 저장을 강제 실행합니다.
    }

    //스테이지 로드   추후 저장된 스테이지 불러오기 가능 시 알림창 yes 버튼에 적용
    public int LoadStage()
    {
        if (PlayerPrefs.HasKey("SaveStage"))
        {
            return PlayerPrefs.GetInt("SaveStage");
        }
        else
        {
            // 저장된 값이 없을 때 추가작업
            return 1; // 또는 원하는 다른 값
        }
    }

    //이어하기
    public void StartSavedStage() 
    {
        audioSource.Play();
        int savedStage = LoadStage();
        Debug.Log("저장된 스테이지 "+ savedStage+"로 이동");
        loadAlert.SetActive(true); // 알림창 활성화
        // 예시: 저장된 스테이지로 씬 로드
        //SceneManager.LoadScene("Stage" + savedStage);
    }

    //새게임
    public void NewStart()
    {
        PlayerPrefs.DeleteAll();
        PlayerPrefs.Save();
        Debug.Log("저장되어있던 데이터를 모두 삭제후 새게임 시작");        
        newAlert.SetActive(true); // 알림창 활성화
        audioSource.Play();
    }

    //스테이지 선택 화면으로 이동
    public void SelectStage()
    {
        SceneManager.LoadScene("Stage Select Screen");
    }

    //설정창 끄기 키기 -> 수정 : SettingMenuContoller.cs에서 끄게 만듦. Dontdestroyonload로 넘어가서는 이 cs에서의 함수가 사용 불가.
    public void openOption()
    {
        // OptionCanvas_Audio가 존재할 경우에만 로직 실행
        if (optionCanvasAudio != null)
        {
            audioSource.Play();

            // optionCanvasAudio의 자식 오브젝트로 있는 option을 찾아서 제어
            GameObject option = optionCanvasAudio.transform.Find("Option").gameObject;

            if (option != null)
            {
                // 패널이 활성화되어 있으면 비활성화, 비활성화되어 있으면 활성화
                if (option.activeSelf)
                {
                    option.SetActive(false);
                }
                else
                {
                    option.SetActive(true);
                }
            }
            else
            {
                Debug.LogError("Option 오브젝트를 찾을 수 없습니다.");
            }
        }
        else
        {
            Debug.LogError("optionCanvasAudio 오브젝트가 존재하지 않습니다.");
        }
    }

    //게임 종료
    public void ExitGame()
    {
        audioSource.Play();
        Application.Quit(); //빌드해야 작동함.
    }

}
